<source>
  @type monitor_agent
  bind 127.0.0.1
  port 24220
</source>

<source>
  @type tail
  @id in_tail_flow_logs
  path "#{ENV['FLOW_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/flows.log.pos"
  tag flows
  emit_unmatched_lines false
  <parse>
    @type json
  </parse>
</source>

<source>
  @type tail
  @id in_tail_dns_logs
  path "#{ENV['DNS_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/dns.log.pos"
  tag dns
  emit_unmatched_lines false
  <parse>
    @type json
  </parse>
</source>

<source>
  @type tail
  @id in_tail_waf_logs
  path "#{ENV['WAF_LOG_FILE']}"
  pos_file "#{ENV['POS_DIR']}/waf.log.pos"
  emit_unmatched_lines false
  read_from_head true
  tag waf
  <parse>
    @type json
  </parse>
</source>

<source>
  @type tail
  @id in_tail_l7_logs
  path "#{ENV['L7_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/l7.log.pos"
  tag l7
  emit_unmatched_lines false
  <parse>
    @type json
  </parse>
</source>

<source>
  @type tail
  @id in_tail_runtime_logs
  path "#{ENV['RUNTIME_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/report.log.pos"
  tag runtime
  emit_unmatched_lines false
  <parse>
    @type json
  </parse>
</source>

<source>
  @type tail
  path "#{ENV['EE_AUDIT_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/tsee-audit.log.pos"
  tag audit.tsee
  emit_unmatched_lines false
  format json
  time_key time
  time_format %Y-%m-%dT%H:%M:%S.%N%z
</source>

<source>
  @type tail
  path "#{ENV['KUBE_AUDIT_LOG']}"
  pos_file "#{ENV['KUBE_AUDIT_POS']}"
  tag audit.kube
  emit_unmatched_lines false
  format json
  time_key time
  time_format %Y-%m-%dT%H:%M:%S.%N%z
</source>

<source>
  @type tail
  @id in_tail_compliance_report_logs
  path "#{ENV['COMPLIANCE_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/compliance.reports.log.pos"
  tag compliance.reports
  emit_unmatched_lines false
  <parse>
    @type json
  </parse>
</source>

<source>
  @type tail
  @id in_tail_bird_logs
  path "#{ENV['BIRD_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/bird.log.pos"
  tag bird
  emit_unmatched_lines false
  <parse>
    @type regexp
    expression /^(?<logtime>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\.\d{5} bird: (?<message>.*)/
  </parse>
</source>

<source>
  @type tail
  @id in_tail_bird6_logs
  path "#{ENV['BIRD6_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/bird6.log.pos"
  tag bird6
  emit_unmatched_lines false
  <parse>
    @type regexp
    expression /^(?<logtime>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\.\d{5} bird: (?<message>.*)/
  </parse>
</source>

<source>
  @type tail
  @id in_tail_ids_event_logs
  path "#{ENV['IDS_EVENT_LOG_FILE']}"
  read_from_head true
  pos_file "#{ENV['POS_DIR']}/ids.events.log.pos"
  tag ids.events
  emit_unmatched_lines false
  <parse>
    @type json
    time_key time
    keep_time_key true
    time_type unixtime
  </parse>
</source>

<source>
  @type prometheus
  bind 0.0.0.0
  port 9081
  metrics_path /metrics
  <transport tls>
    cert_path "#{ENV['TLS_CRT_PATH']}"
    private_key_path "#{ENV['TLS_KEY_PATH']}"
    ca_path "#{ENV['CA_CRT_PATH']}"
    client_cert_auth true
  </transport>
</source>

<source>
  @type prometheus_monitor
  <labels>
    hostname ${hostname}
  </labels>
</source>

<source>
  @type prometheus_output_monitor
  <labels>
    hostname ${hostname}
  </labels>
</source>

<source>
  @type prometheus_tail_monitor
  <labels>
    hostname ${hostname}
  </labels>
</source>
