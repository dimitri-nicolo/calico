From e798ecdeb502dff8601cfa40ae2347236e738411 Mon Sep 17 00:00:00 2001
From: rene-dekker <rene@tigera.io>
Date: Fri, 15 Nov 2024 13:56:00 -0800
Subject: [PATCH] Bump dependency versions to mitigate CVEs

---
 build-tools-internal/version.properties |   6 +-
 gradle/verification-metadata.xml        | 130 +++++++++++++++++++++++-
 x-pack/plugin/ml/build.gradle           |  23 +----
 x-pack/plugin/security/build.gradle     |   4 +-
 4 files changed, 135 insertions(+), 28 deletions(-)

diff --git a/build-tools-internal/version.properties b/build-tools-internal/version.properties
index f7391b3e403..476eda8e6d8 100644
--- a/build-tools-internal/version.properties
+++ b/build-tools-internal/version.properties
@@ -2,13 +2,13 @@ elasticsearch     = 7.17.25
 lucene            = 8.11.3

 bundled_jdk_vendor = openjdk
-bundled_jdk = 22.0.1+8@c7ec1332f7bb44aeba2eb341ae18aca4
+bundled_jdk = 22.0.2+9@c9ecb94cd31b495da20a27d4581645e8
 # optional dependencies
 spatial4j         = 0.7
 jts               = 1.15.0
 jackson           = 2.14.2
 snakeyaml         = 1.33
-icu4j             = 62.1
+icu4j             = 68.2
 supercsv          = 2.4.0
 # when updating log4j, please update also docs/java-api/index.asciidoc
 log4j             = 2.17.1
@@ -16,7 +16,7 @@ slf4j             = 1.6.2

 jna               = 5.10.0

-netty             = 4.1.94.Final
+netty             = 4.1.115.Final
 joda              = 2.12.6

 commons_lang3                   = 3.9
diff --git a/gradle/verification-metadata.xml b/gradle/verification-metadata.xml
index 12861a9fe4d..dc12f53eb79 100644
--- a/gradle/verification-metadata.xml
+++ b/gradle/verification-metadata.xml
@@ -879,6 +879,11 @@
             <sha256 value="e5b0962e566003d68bf3ec7d87b60e279f5cc7aa93cbc4056432803046512478" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="com.ibm.icu" name="icu4j" version="68.2">
+         <artifact name="icu4j-68.2.jar">
+            <sha256 value="9bd7bf869a44ba8aeb0cddd7e6616e88cd4795ba5bfce2230447cb0e185a646c" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="com.jamesmurty.utils" name="java-xmlbuilder" version="0.4">
          <artifact name="java-xmlbuilder-0.4.jar">
             <sha256 value="681e53c4ffd59fa12068803b259e3a83d43f07a47c112e748a187dee179eb31f" origin="Generated by Gradle"/>
@@ -1009,9 +1014,11 @@
             <sha256 value="fbfd0d5f2b2f86758b821daa5e79b5d7c965edd9dc1b2cc80b515df1c6ddc22d" origin="Generated by Gradle"/>
          </artifact>
       </component>
-      <component group="com.nimbusds" name="nimbus-jose-jwt" version="9.23">
-         <artifact name="nimbus-jose-jwt-9.23.jar">
-            <sha256 value="33ab8084fdae1d75be1b061b1489d4a12045bd7b50c2e24ff152911e4551ec07" origin="Generated by Gradle"/>
+      <component group="com.nimbusds" name="nimbus-jose-jwt" version="9.37.3">
+         <artifact name="nimbus-jose-jwt-9.37.3.jar">
+            <sha256 value="12ae4a3a260095d7aeba2adea7ae396e8b9570db8b7b409e09a824c219cc0444" origin="Generated by Gradle">
+               <also-trust value="afc63b689d881439b95f343b1dca750391edac63b87392be4d90d19c94ccafbe"/>
+            </sha256>
          </artifact>
       </component>
       <component group="com.nimbusds" name="nimbus-jose-jwt" version="9.8.1">
@@ -1419,6 +1426,13 @@
             <sha256 value="a3ebec96768ee4a2d3db44597e84cea2d0bdd68ca04822397980ea9f67075a86" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-buffer" version="4.1.115.Final">
+         <artifact name="netty-buffer-4.1.115.Final.jar">
+            <sha256 value="ed49956c1e5d99534af2e9e9ecb80f4d3390c631c6cedd2a94d23aedcc911bb9" origin="Generated by Gradle">
+               <also-trust value="4a7b331d3770c566ab70eb02a0d1feed63b95cf6e4d68c8fe778c4c9de2d116d"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-buffer" version="4.1.42.Final">
          <artifact name="netty-buffer-4.1.42.Final.jar">
             <sha256 value="7b0171a4e8bcd573e08d9f2bba053c67b557ab5012106a5982ccbae5743814c0" origin="Generated by Gradle"/>
@@ -1434,6 +1448,13 @@
             <sha256 value="8066ee7c49f9f29da96ee62f7cb13bee022cb4b68e51437b33da3b6d01398f13" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec" version="4.1.115.Final">
+         <artifact name="netty-codec-4.1.115.Final.jar">
+            <sha256 value="2df943cd3ed24f86d61d442314e8a9a4c06b85a9a7aa99cec8c6520e77ff3f1c" origin="Generated by Gradle">
+               <also-trust value="cd189afb70ec6eacfcdfdd3a5f472b4e705a5c91d5bd3ef0386421f2ae15ec77"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec" version="4.1.42.Final">
          <artifact name="netty-codec-4.1.42.Final.jar">
             <sha256 value="e96ced697fb7df589da7c20c995e01f75a9cb246be242bbc4cd3b4af424ff189" origin="Generated by Gradle"/>
@@ -1449,6 +1470,13 @@
             <sha256 value="91243776ad68b4d8e39eafb9ec115e1b8fa9aecd147b12ef15bb691639498328" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-dns" version="4.1.115.Final">
+         <artifact name="netty-codec-dns-4.1.115.Final.jar">
+            <sha256 value="a67a84c0a46094815e2044ac1314d8d81089d219ec8e8c732f9a12ba4cd451bd" origin="Generated by Gradle">
+               <also-trust value="23dd6806bcc326855f13e69838c6411d0490e6b1aeb12e217a19a3dd6ad3f10d"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-dns" version="4.1.53.Final">
          <artifact name="netty-codec-dns-4.1.53.Final.jar">
             <sha256 value="747098d17592d092afdfd8c746e099c3b739986461ebcfa68d782f4b5b19b8ae" origin="Generated by Gradle"/>
@@ -1459,6 +1487,13 @@
             <sha256 value="b345048b7692204803b49eb11f5203b52e18aa7647f8b77dd63118fd8d5fd2a2" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-http" version="4.1.115.Final">
+         <artifact name="netty-codec-http-4.1.115.Final.jar">
+            <sha256 value="fdf056b08e156797d8f6caa727af0370dea8265b1eff8fc6f9e739c5c1f093d1" origin="Generated by Gradle">
+               <also-trust value="e6dbe971c59373bbae9802021c63b9bc1d8800fead382863d67e79e79b023166"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-http" version="4.1.53.Final">
          <artifact name="netty-codec-http-4.1.53.Final.jar">
             <sha256 value="48a81eec058871c4eaf66670f824a76f403579c53ac7a6840dd6ace9dfc4ad4e" origin="Generated by Gradle"/>
@@ -1469,6 +1504,13 @@
             <sha256 value="1ada4580f68cd17a534fb3c0337087073223a76cb77304dbe5a1b19df3d53c2f" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-http2" version="4.1.115.Final">
+         <artifact name="netty-codec-http2-4.1.115.Final.jar">
+            <sha256 value="a75498995087968b4582aefe42cfa8ca257759f32279edbec3c874e54acf633c" origin="Generated by Gradle">
+               <also-trust value="cbed9829a5d582e91e314e209edce9a0c2eb369f23bb4fb74a5bc8b7990222c2"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-http2" version="4.1.53.Final">
          <artifact name="netty-codec-http2-4.1.53.Final.jar">
             <sha256 value="6c777f308be5bb53f33925e695dc97f0b88688e2f1937c2c7a3975e977362df4" origin="Generated by Gradle"/>
@@ -1479,6 +1521,13 @@
             <sha256 value="8fbd2e95abec6155b60ed3c9c1600ed4e17ffe3f053cd5a40677d879c0af961f" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-codec-socks" version="4.1.115.Final">
+         <artifact name="netty-codec-socks-4.1.115.Final.jar">
+            <sha256 value="a8b2c52807e4071f8fdd6239b8fd0c4d2cd282ebf08406f8d431d3229b69418e" origin="Generated by Gradle">
+               <also-trust value="e9b1cc744dc6195894450b1fd4d271a821ab167fe21ae3c459b27cdadc70e81f"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-codec-socks" version="4.1.53.Final">
          <artifact name="netty-codec-socks-4.1.53.Final.jar">
             <sha256 value="8de51d13f48da8eece7df43aa00d6d2923a215668526d8888879fa1534e9aafe" origin="Generated by Gradle"/>
@@ -1489,6 +1538,13 @@
             <sha256 value="1c0b4ee0b623402dd5bb78fd4a69bf808da2510524f489a24b0f3cc58ded046e" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-common" version="4.1.115.Final">
+         <artifact name="netty-common-4.1.115.Final.jar">
+            <sha256 value="33bf51077021de2b9d80b9ec64a4fae68f22e6ec56f52431441eaf6dd79cce71" origin="Generated by Gradle">
+               <also-trust value="39f1b5a2aaa4eab5d036dfd0486e35a4276df412e092d36b2d88b494705a134d"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-common" version="4.1.42.Final">
          <artifact name="netty-common-4.1.42.Final.jar">
             <sha256 value="3d0a918d78292eeca02a7bb2188daa4e5053b6e29b71e6308309033e121242b5" origin="Generated by Gradle"/>
@@ -1504,6 +1560,13 @@
             <sha256 value="cb8d84a3e63aea90d0d7a333a02e50ac751d2b05db55745d981b5eff893f647b" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-handler" version="4.1.115.Final">
+         <artifact name="netty-handler-4.1.115.Final.jar">
+            <sha256 value="1161e2ed8e1f037124a8ddfe3d4184ebaa7be17aea27e7fca87f510f17898ea5" origin="Generated by Gradle">
+               <also-trust value="5972028cc863b74927ce0d11fb8d58f65da2560bef5602fe8ce8903bd306ca07"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-handler" version="4.1.42.Final">
          <artifact name="netty-handler-4.1.42.Final.jar">
             <sha256 value="11eda86500c33b9d386719b5419f513fd9c097d13894f25dd0c75b610d636e03" origin="Generated by Gradle"/>
@@ -1519,6 +1582,13 @@
             <sha256 value="8e50719a9ab89e33ef85c5f36d780e0d7056b3f768b07d261d87baed7094eb3c" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-handler-proxy" version="4.1.115.Final">
+         <artifact name="netty-handler-proxy-4.1.115.Final.jar">
+            <sha256 value="42e34c84423f074a4db4576e6d1ddabf56eb26705213e5f9b6ef537ce36bcd0b" origin="Generated by Gradle">
+               <also-trust value="807e67cfb17136927d11db42df62031169d1fa0883e13f254906994c84ffbe87"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-handler-proxy" version="4.1.53.Final">
          <artifact name="netty-handler-proxy-4.1.53.Final.jar">
             <sha256 value="1f4b5a540f596e45bcde7c53f4c02780aa5e56eea4103eee78b7d104f90c97b1" origin="Generated by Gradle"/>
@@ -1529,6 +1599,13 @@
             <sha256 value="378738bfeb84c81228ae5de209f964ca87849f9a720c916c77f7cba6494bb1ec" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-resolver" version="4.1.115.Final">
+         <artifact name="netty-resolver-4.1.115.Final.jar">
+            <sha256 value="e168920249ea8d65076b0847e64464b5132843f1f1b2ff514e45fa255b64300b" origin="Generated by Gradle">
+               <also-trust value="7b3455d14f59828765a00573bc3967dc59379e874bd62a67eb1926d6512109d1"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-resolver" version="4.1.42.Final">
          <artifact name="netty-resolver-4.1.42.Final.jar">
             <sha256 value="89768242b6b7cce9bd9f5945ad21d1b4bae515c6b1bf03a8af5d1899779cebc9" origin="Generated by Gradle"/>
@@ -1544,6 +1621,13 @@
             <sha256 value="bd26e9bc5e94e2d3974a93fdf921658eff4f033bfd4c5208607760ab54298617" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-resolver-dns" version="4.1.115.Final">
+         <artifact name="netty-resolver-dns-4.1.115.Final.jar">
+            <sha256 value="7e354a85f8147744aeb9d3e1e64ace18f6432a25c09f8bde57383959a842c967" origin="Generated by Gradle">
+               <also-trust value="4aca31593e5896c64ab7e041bbc6c0d851bd9634ec3a4354208141a35576619f"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-resolver-dns" version="4.1.53.Final">
          <artifact name="netty-resolver-dns-4.1.53.Final.jar">
             <sha256 value="bb63961902ce4a4724e80efde16a63b06f871a2cb2387eb90aa2c3663f17db90" origin="Generated by Gradle"/>
@@ -1554,6 +1638,13 @@
             <sha256 value="d6a0871adbc47ce4b08ab7c23c6e32047bd197641f5f3fd35d165faed79a89e8" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-transport" version="4.1.115.Final">
+         <artifact name="netty-transport-4.1.115.Final.jar">
+            <sha256 value="c1ac17ce337d945290be680d7be942b7b4ff4c989be8ec24c684b3e94438da52" origin="Generated by Gradle">
+               <also-trust value="c3d71faaa736ffd2c9260ab0b498024b814c39c7d764bea8113fa98de6e2bdd2"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-transport" version="4.1.42.Final">
          <artifact name="netty-transport-4.1.42.Final.jar">
             <sha256 value="dfa817a156ea263aa9ad8364a2e226527665c9722aca40a7945f228c2c14f1da" origin="Generated by Gradle"/>
@@ -1579,6 +1670,13 @@
             <sha256 value="e0685ad59b8c00eff7abe0caed8db08b9a0471f2c848958515008bc48fe73238" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="io.netty" name="netty-transport-native-unix-common" version="4.1.115.Final">
+         <artifact name="netty-transport-native-unix-common-4.1.115.Final.jar">
+            <sha256 value="61e66832820f257bbee68722ec088b39da383c213eafbd1767097a7fff5d029f" origin="Generated by Gradle">
+               <also-trust value="4b03e716272657c296b0204b57c140b2b2ca96b1a746c92da41f595892ec6d88"/>
+            </sha256>
+         </artifact>
+      </component>
       <component group="io.netty" name="netty-transport-native-unix-common" version="4.1.42.Final">
          <artifact name="netty-transport-native-unix-common-4.1.42.Final.jar">
             <sha256 value="508fba9128da78bd775ba854d71917ceb2b00b95a7600254f54a277a06761a86" origin="Generated by Gradle"/>
@@ -1872,6 +1970,11 @@
             <sha256 value="0972bbc99437c4163acd09b630e6c77eab4cfab8a9594621c95466c0c6645396" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="net.minidev" name="accessors-smart" version="2.4.8">
+         <artifact name="accessors-smart-2.4.8.jar">
+            <sha256 value="7dd705aa1ac0e030f8ee2624e8e77239ae1eef6ccc2621c0b8c189866ee1c42c" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="net.minidev" name="json-smart" version="2.3">
          <artifact name="json-smart-2.3.jar">
             <sha256 value="903f48c8aa4c3f6426440b8d32de89fa1dc23b1169abde25e4e1d068aa67708b" origin="Generated by Gradle"/>
@@ -1961,6 +2064,14 @@
             <sha256 value="133c8b65113304904cdef7c9103274d141cfb64b191ff48ceb6528aca25c67b1" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="openjdk_22" name="linux" version="22.0.2">
+         <artifact name="linux-22.0.2-aarch64.tar.gz">
+            <sha256 value="25fba2bd5585e1e9923134dc827f2bd5a2beaca3d242ae00b7e68c152faf7ba6" origin="Generated by Gradle"/>
+         </artifact>
+         <artifact name="linux-22.0.2-x64.tar.gz">
+            <sha256 value="41536f115668308ecf4eba92aaf6acaeb0936225828b741efd83b6173ba82963" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="openjdk_22" name="macos" version="22.0.1">
          <artifact name="macos-22.0.1-aarch64.tar.gz">
             <sha256 value="b949a3bc13e3c5152ab55d12e699dfa6c8b00bedeb8302b13be4aec3ee734351" origin="Generated by Gradle"/>
@@ -1969,11 +2080,24 @@
             <sha256 value="5daa4f9894cc3a617a5f9fe2c48e5391d3a2e672c91e1597041672f57696846f" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="openjdk_22" name="macos" version="22.0.2">
+         <artifact name="macos-22.0.2-aarch64.tar.gz">
+            <sha256 value="3dab98730234e1a87aec14bcb8171d2cae101e96ff4eed1dab96abbb08e843fd" origin="Generated by Gradle"/>
+         </artifact>
+         <artifact name="macos-22.0.2-x64.tar.gz">
+            <sha256 value="e8b3ec7a7077711223d31156e771f11723cd7af31c2017f1bd2eda20855940fb" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="openjdk_22" name="windows" version="22.0.1">
          <artifact name="windows-22.0.1-x64.zip">
             <sha256 value="de7f00fd1bd0d3a4c678fff2681dfad19284d74d357218a4be6f623488d040da" origin="Generated by Gradle"/>
          </artifact>
       </component>
+      <component group="openjdk_22" name="windows" version="22.0.2">
+         <artifact name="windows-22.0.2-x64.zip">
+            <sha256 value="f2a9b9ab944e71a64637fcdc6b13a1188cf02d4eb9ecf71dc927e98b3e45f5dc" origin="Generated by Gradle"/>
+         </artifact>
+      </component>
       <component group="org.abego.treelayout" name="org.abego.treelayout.core" version="1.0.3">
          <artifact name="org.abego.treelayout.core-1.0.3.jar">
             <sha256 value="fa5e31395c39c2e7d46aca0f81f72060931607b2fa41bd36038eb2cb6fb93326" origin="Generated by Gradle"/>
diff --git a/x-pack/plugin/ml/build.gradle b/x-pack/plugin/ml/build.gradle
index c13d178c3b2..83c4075e0f7 100644
--- a/x-pack/plugin/ml/build.gradle
+++ b/x-pack/plugin/ml/build.gradle
@@ -1,5 +1,3 @@
-import org.elasticsearch.gradle.VersionProperties
-
 apply plugin: 'elasticsearch.internal-es-plugin'
 apply plugin: 'elasticsearch.internal-cluster-test'
 apply plugin: 'elasticsearch.internal-test-artifact'
@@ -13,8 +11,6 @@ esplugin {
   extendedPlugins = ['x-pack-autoscaling', 'lang-painless']
 }

-def localRepo = providers.systemProperty('build.ml_cpp.repo').orNull
-
 if (useDra == false) {
   repositories {
     exclusiveContent {
@@ -24,26 +20,13 @@ if (useDra == false) {
       forRepository {
         ivy {
           name "ml-cpp"
+          url providers.systemProperty('build.ml_cpp.repo').orElse('https://prelert-artifacts.s3.amazonaws.com').get()
           metadataSources {
             // no repository metadata, look directly for the artifact
             artifact()
           }
-          if (localRepo) {
-            url localRepo
-            patternLayout {
-              artifact "maven/[orgPath]/[module]/[revision]/[module]-[revision](-[classifier]).[ext]"
-            }
-          } else {
-            url "https://artifacts-snapshot.elastic.co/"
-            patternLayout {
-              if (VersionProperties.isElasticsearchSnapshot()) {
-                artifact '/ml-cpp/[revision]/downloads/ml-cpp/[module]-[revision](-[classifier]).[ext]'
-              } else {
-                // When building locally we always use snapshot artifacts even if passing `-Dbuild.snapshot=false`.
-                // Release builds are always done with a local repo.
-                artifact '/ml-cpp/[revision]-SNAPSHOT/downloads/ml-cpp/[module]-[revision]-SNAPSHOT(-[classifier]).[ext]'
-              }
-            }
+          patternLayout {
+            artifact "maven/org/elasticsearch/ml/ml-cpp/[revision]/ml-cpp-[revision].[ext]"
           }
         }
       }
diff --git a/x-pack/plugin/security/build.gradle b/x-pack/plugin/security/build.gradle
index baaa6b9b746..282575031e1 100644
--- a/x-pack/plugin/security/build.gradle
+++ b/x-pack/plugin/security/build.gradle
@@ -69,7 +69,7 @@ dependencies {

   // Dependencies for oidc
   api "com.nimbusds:oauth2-oidc-sdk:9.37"
-  api "com.nimbusds:nimbus-jose-jwt:9.23"
+  api "com.nimbusds:nimbus-jose-jwt:9.37.3"
   api "com.nimbusds:lang-tag:1.4.4"
   api "com.sun.mail:jakarta.mail:1.6.3"
   api "net.jcip:jcip-annotations:1.0"
@@ -92,7 +92,7 @@ dependencies {
   testImplementation('org.apache.kerby:kerb-crypto:1.1.1')
   testImplementation('org.apache.kerby:kerb-util:1.1.1')
   testImplementation('org.apache.kerby:token-provider:1.1.1')
-  testImplementation('com.nimbusds:nimbus-jose-jwt:9.23')
+  testImplementation('com.nimbusds:nimbus-jose-jwt:9.37.3')
   testImplementation('net.jcip:jcip-annotations:1.0')
   testImplementation('org.apache.kerby:kerb-admin:1.1.1')
   testImplementation('org.apache.kerby:kerb-server:1.1.1')
--
2.34.1

